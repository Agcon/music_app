<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Music App ‚Äî –¢—Ä–µ–∫–∏</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<header class="site-header">
  <div class="logo">
    <a href="/tracks">üéµ Music App</a>
  </div>
  {{if .IsAuthenticated}}
  <div class="user-info">
    <span>{{.Email}}</span>
    <form action="/logout" method="post" style="display:inline;">
      <button type="submit">–í—ã–π—Ç–∏</button>
    </form>
  </div>
  {{else}}
  <nav>
    <a href="/login">–í–æ–π—Ç–∏</a>
    <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
  </nav>
  {{end}}
</header>

<div class="container">
  <h2>–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤</h2>

  <div class="search-bar">
    <form method="get" action="/tracks">
      <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏—Å—Ç—É" value="{{.Query}}">
      <button type="submit">–ù–∞–π—Ç–∏</button>
    </form>
  </div>

  <div class="track-list">
    {{range .Tracks}}
    <div class="track-card">
      <div class="track-info">
        <h3>{{.Title}}</h3>
        <div class="artist-line">
          <span class="icon">üë§</span>
          <span class="artist-name">{{.Artist}}</span>
        </div>
        <div class="genre-line">
          <span class="icon">üéß</span>
          <span class="genre-name">{{.Genre}}</span>
        </div>
      </div>
      <div class="track-actions">
        <a class="btn" href="/tracks/{{.ID.Hex}}/playview">–°–ª—É—à–∞—Ç—å</a>
        {{if eq $.Role "admin"}}
        <form action="/tracks/{{.ID.Hex}}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫?');">
          <input type="hidden" name="_method" value="DELETE">
          <button type="button" class="btn danger" onclick="deleteTrack('{{.ID.Hex}}')">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
        {{end}}
      </div>
    </div>
    {{else}}
    <p>–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤.</p>
    {{end}}
  </div>

  <div class="pagination">
    {{if gt .Page 1}}
    <a class="btn" href="/tracks?page={{sub .Page 1}}{{if .Query}}&q={{.Query}}{{end}}">‚Üê –ù–∞–∑–∞–¥</a>
    {{end}}
    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{.Page}}</span>
    {{if .HasNext}}
    <a class="btn" href="/tracks?page={{add .Page 1}}{{if .Query}}&q={{.Query}}{{end}}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
    {{end}}
  </div>

  <div style="margin-top: 30px;">
    <a class="btn" href="/upload">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ç—Ä–µ–∫</a>
  </div>
</div>

<script>
  function deleteTrack(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫?')) return;

    fetch('/tracks/' + id, {
      method: 'DELETE',
      credentials: 'include'
    }).then(res => {
      if (res.ok) {
        location.reload();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
      }
    });
  }
</script>
</body>
</html>
